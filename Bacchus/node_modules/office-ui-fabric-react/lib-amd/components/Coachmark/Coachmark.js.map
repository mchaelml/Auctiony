{"version":3,"file":"Coachmark.js","sourceRoot":"../src/","sources":["components/Coachmark/Coachmark.tsx"],"names":[],"mappings":"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","sourcesContent":["// Utilities\r\nimport * as React from 'react';\r\nimport { BaseComponent, classNamesFunction, createRef } from '../../Utilities';\r\nimport { DefaultPalette } from '../../Styling';\r\n\r\n// Component Dependencies\r\nimport { PositioningContainer, IPositioningContainer } from './PositioningContainer/index';\r\nimport { Beak } from './Beak/Beak';\r\n\r\n// Coachmark\r\nimport { ICoachmarkTypes } from './Coachmark.types';\r\nimport { getStyles, ICoachmarkStyles, ICoachmarkStyleProps } from './Coachmark.styles';\r\nimport { FocusZone } from '../../FocusZone';\r\n\r\nconst getClassNames = classNamesFunction<ICoachmarkStyleProps, ICoachmarkStyles>();\r\n\r\n/**\r\n * An interface for the cached dimensions of entity inner host.\r\n */\r\nexport interface IEntityRect {\r\n  width: number;\r\n  height: number;\r\n}\r\n\r\nexport interface ICoachmarkState {\r\n  /**\r\n   * Is the Coachmark currently collapsed into\r\n   * a tear drop shape\r\n   */\r\n  collapsed: boolean;\r\n\r\n  /**\r\n   * Enables/Disables the beacon that radiates\r\n   * from the center of the coachmark.\r\n   */\r\n  isBeaconAnimating: boolean;\r\n\r\n  /**\r\n   * Is the teaching bubble currently retreiving the\r\n   * original dimensions of the hosted entity.\r\n   */\r\n  isMeasuring: boolean;\r\n\r\n  /**\r\n   * Cached width and height of _entityInnerHostElement\r\n   */\r\n  entityInnerHostRect: IEntityRect;\r\n\r\n  /**\r\n   * Is the mouse in proximity of the default target element\r\n   */\r\n  isMouseInProximity: boolean;\r\n\r\n  /**\r\n   * The left position of the beak\r\n   */\r\n  beakLeft?: string | null;\r\n\r\n  /**\r\n   * The right position of the beak\r\n   */\r\n  beakTop?: string | null;\r\n}\r\n\r\nexport class Coachmark extends BaseComponent<ICoachmarkTypes, ICoachmarkState> {\r\n  public static defaultProps: Partial<ICoachmarkTypes> = {\r\n    collapsed: true,\r\n    mouseProximityOffset: 100,\r\n    beakWidth: 26,\r\n    beakHeight: 12,\r\n    delayBeforeMouseOpen: 3600, // The approximate time the coachmark shows up\r\n    width: 36,\r\n    height: 36,\r\n    color: DefaultPalette.themePrimary\r\n  };\r\n\r\n  /**\r\n   * The cached HTMLElement reference to the Entity Inner Host\r\n   * element.\r\n   */\r\n  private _entityInnerHostElement = createRef<HTMLDivElement>();\r\n  private _translateAnimationContainer = createRef<HTMLDivElement>();\r\n  private _positioningContainer = createRef<IPositioningContainer>();\r\n\r\n  constructor(props: ICoachmarkTypes) {\r\n    super(props);\r\n\r\n    // Set defaults for state\r\n    this.state = {\r\n      collapsed: props.collapsed!,\r\n      isBeaconAnimating: true,\r\n      isMeasuring: true,\r\n      entityInnerHostRect: {\r\n        width: 0,\r\n        height: 0\r\n      },\r\n      isMouseInProximity: false\r\n    };\r\n  }\r\n\r\n  public render(): JSX.Element {\r\n    const {\r\n      children,\r\n      beakWidth,\r\n      beakHeight,\r\n      target,\r\n      width,\r\n      height,\r\n      color\r\n    } = this.props;\r\n\r\n    const classNames = getClassNames(getStyles, {\r\n      collapsed: this.state.collapsed,\r\n      isBeaconAnimating: this.state.isBeaconAnimating,\r\n      isMeasuring: this.state.isMeasuring,\r\n      entityHostHeight: this.state.entityInnerHostRect.height + 'px',\r\n      entityHostWidth: this.state.entityInnerHostRect.width + 'px',\r\n      width: width + 'px',\r\n      height: height + 'px',\r\n      color: color\r\n    });\r\n\r\n    return (\r\n      <PositioningContainer\r\n        target={ target }\r\n        offsetFromTarget={ beakHeight }\r\n        componentRef={ this._positioningContainer }\r\n      >\r\n        <div className={ classNames.root }>\r\n          <div className={ classNames.pulsingBeacon } />\r\n          <div\r\n            className={ classNames.translateAnimationContainer }\r\n            ref={ this._translateAnimationContainer }\r\n          >\r\n            <div className={ classNames.scaleAnimationLayer }>\r\n              <div className={ classNames.rotateAnimationLayer }>\r\n                {\r\n                  this._positioningContainer.current && <Beak\r\n                    width={ beakWidth }\r\n                    height={ beakHeight }\r\n                    left={ this.state.beakLeft }\r\n                    top={ this.state.beakTop }\r\n                  />\r\n                }\r\n                <FocusZone>\r\n                  <div\r\n                    className={ classNames.entityHost }\r\n                    data-is-focusable={ true }\r\n                    onFocus={ this._onFocusHandler }\r\n                  >\r\n                    <div\r\n                      className={ classNames.entityInnerHost }\r\n                      ref={ this._entityInnerHostElement }\r\n                    >\r\n                      { children }\r\n                    </div>\r\n                  </div>\r\n                </FocusZone>\r\n              </div>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </PositioningContainer>\r\n    );\r\n  }\r\n\r\n  public componentWillReceiveProps(newProps: ICoachmarkTypes): void {\r\n    if (this.props.collapsed && !newProps.collapsed) {\r\n      // The coachmark is about to open\r\n      this._openCoachmark();\r\n    }\r\n  }\r\n\r\n  public componentDidMount(): void {\r\n    this._async.requestAnimationFrame(((): void => {\r\n      if (this._entityInnerHostElement.current && (this.state.entityInnerHostRect.width + this.state.entityInnerHostRect.width) === 0) {\r\n\r\n        // @TODO Eventually we need to add the various directions\r\n        const beakLeft = (this.props.width! / 2) - (this.props.beakWidth! / 2);\r\n        const beakTop = 0;\r\n\r\n        this.setState({\r\n          isMeasuring: false,\r\n          entityInnerHostRect: {\r\n            width: this._entityInnerHostElement.current.offsetWidth,\r\n            height: this._entityInnerHostElement.current.offsetHeight\r\n          },\r\n          beakLeft: beakLeft + 'px',\r\n          beakTop: beakTop + 'px'\r\n        });\r\n\r\n        this.forceUpdate();\r\n      }\r\n\r\n      // We dont want to the user to immediatley trigger the coachmark when it's opened\r\n      this._async.setTimeout(() => {\r\n        this._addProximityHandler(100);\r\n      }, this.props.delayBeforeMouseOpen!);\r\n    }));\r\n  }\r\n\r\n  private _onFocusHandler = (): void => {\r\n    this._openCoachmark();\r\n  }\r\n\r\n  private _openCoachmark = (): void => {\r\n    this.setState({\r\n      collapsed: false\r\n    });\r\n\r\n    this._translateAnimationContainer.current && this._translateAnimationContainer.current.addEventListener('animationstart', (): void => {\r\n      if (this.props.onAnimationOpenStart) {\r\n        this.props.onAnimationOpenStart();\r\n      }\r\n    });\r\n\r\n    this._translateAnimationContainer.current && this._translateAnimationContainer.current.addEventListener('animationend', (): void => {\r\n      if (this.props.onAnimationOpenEnd) {\r\n        this.props.onAnimationOpenEnd();\r\n      }\r\n    });\r\n  }\r\n\r\n  private _addProximityHandler(mouseProximityOffset: number = 0): void {\r\n    /**\r\n     * An array of cached ids returned when setTimeout runs during\r\n     * the window resize event trigger.\r\n     */\r\n    const timeoutIds: number[] = [];\r\n\r\n    /**\r\n     * The target element the mouse would be in\r\n     * proximity to\r\n     */\r\n    let targetElementRect: ClientRect;\r\n\r\n    // Take the initial measure out of the initial render to prevent\r\n    // an unnecessary render.\r\n    this._async.setTimeout(() => {\r\n      if (this._entityInnerHostElement.current) {\r\n        targetElementRect = this._entityInnerHostElement.current.getBoundingClientRect();\r\n      }\r\n\r\n      // When the window resizes we want to async\r\n      // get the bounding client rectangle.\r\n      // Every time the event is triggered we want to\r\n      // setTimeout and then clear any previous instances\r\n      // of setTimeout.\r\n      this._events.on(window, 'resize', (): void => {\r\n        timeoutIds.forEach((value: number): void => {\r\n          clearInterval(value);\r\n        });\r\n\r\n        timeoutIds.push(this._async.setTimeout((): void => {\r\n          if (this._entityInnerHostElement.current) {\r\n            targetElementRect = this._entityInnerHostElement.current.getBoundingClientRect();\r\n          }\r\n        }, 100));\r\n      });\r\n    }, 10);\r\n\r\n    // Every time the document's mouse move is triggered\r\n    // we want to check if inside of an element and\r\n    // set the state with the result.\r\n    this._events.on(document, 'mousemove', (e: MouseEvent) => {\r\n      const mouseY = e.pageY;\r\n      const mouseX = e.pageX;\r\n      const isMouseInProximity = this._isInsideElement(mouseX, mouseY, targetElementRect, mouseProximityOffset);\r\n\r\n      if (isMouseInProximity !== this.state.isMouseInProximity) {\r\n        // We don't want to update the isMouseInProximtiy state because\r\n        // The coachmark only opens and does not collapse.\r\n        // Setting isMouseInProximity here will cause the coachmark to open and close\r\n        this.setState({\r\n          collapsed: !isMouseInProximity\r\n        });\r\n      }\r\n\r\n      if (this.props.onMouseMove) {\r\n        this.props.onMouseMove(e);\r\n      }\r\n    });\r\n  }\r\n\r\n  private _isInsideElement(mouseX: number, mouseY: number, elementRect: ClientRect, mouseProximityOffset: number = 0): boolean {\r\n    return mouseX > (elementRect.left - mouseProximityOffset) &&\r\n      mouseX < ((elementRect.left + elementRect.width) + mouseProximityOffset) &&\r\n      mouseY > (elementRect.top - mouseProximityOffset) &&\r\n      mouseY < ((elementRect.top + elementRect.height) + mouseProximityOffset);\r\n  }\r\n}"]}